<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>DNCL Contest</title>
<style>
  body { font-family: sans-serif; margin: 40px auto; width: 90%; max-width: 800px; }
  textarea { width: 100%; height: 200px; margin-top: 10px; }
  select, button { margin-top: 10px; padding: 6px 12px; }
  #result, #description, #sample { margin-top: 20px; font-size: 16px; white-space: pre-wrap; }
</style>
</head>
<body>

<h1>DNCL Contest</h1>

<!-- 問題選択 -->
<label>問題番号: 
  <select id="problemSelect" onchange="updateProblem()"> </select>
</label>

<label>小問: 
  <select id="subSelect" onchange="updateProblem()"> </select>
</label>

<!-- 問題内容表示 -->
<div id="description"></div>
<div id="sample"></div>
<button onclick="insertSample()">サンプル入力をコードにセット</button>

<!-- コード入力 -->
<textarea id="code" placeholder="ここにDNCLコードを入力"></textarea><br>
<button onclick="submitCode()">提出</button>

<!-- 結果表示 -->
<pre id="result"></pre>

<script>
// ----- 問題データ -----
const problems = {
  "1": {
    "description": "問題1: 入力 N M → N+M を出力せよ",
    "A": { sampleInput: "2 3", expected: "5" },
    "B": { sampleInput: "7 8", expected: "15" },
    "C": { sampleInput: "100 200", expected: "300" }
  },
  "2": {
    "description": "問題2: 2つの整数の差を出力せよ",
    "A": { sampleInput: "10 5", expected: "5" },
    "B": { sampleInput: "20 7", expected: "13" },
    "C": { sampleInput: "50 30", expected: "20" }
  },
  "3": {
    "description": "問題3: 2つの整数の積を出力せよ",
    "A": { sampleInput: "5 7", expected: "35" },
    "B": { sampleInput: "8 5", expected: "40" },
    "C": { sampleInput: "9 5", expected: "45" }
  }
};

// ----- 初期化 -----
const problemSelect = document.getElementById("problemSelect");
const subSelect = document.getElementById("subSelect");

function initProblemSelect() {
  problemSelect.innerHTML = "";
  for (let p in problems) {
    problemSelect.innerHTML += `<option value="${p}">${p}</option>`;
  }
  updateSubSelect();
  updateProblem();
}

function updateSubSelect() {
  const p = problemSelect.value;
  subSelect.innerHTML = "";
  for (let sub in problems[p]) {
    if(sub !== "description") {
      subSelect.innerHTML += `<option value="${sub}">${sub}</option>`;
    }
  }
}

// ----- 問題内容表示 -----
function updateProblem() {
  updateSubSelect();
  const p = problemSelect.value;
  const sub = subSelect.value;
  const descElem = document.getElementById("description");
  const sampleElem = document.getElementById("sample");

  descElem.textContent = problems[p].description;
  sampleElem.textContent = `小問${sub} サンプル入力: ${problems[p][sub].sampleInput}`;
}

// ----- サンプル入力をコードにコピー -----
function insertSample() {
  const p = problemSelect.value;
  const sub = subSelect.value;
  const sample = problems[p][sub].sampleInput;
  const codeArea = document.getElementById("code");
  codeArea.value = `N, M = ${sample}\n`;  // DNCL風に
}

// ----- 提出 -----
async function submitCode() {
  const problemId = problemSelect.value;
  const subId = subSelect.value;
  const code = document.getElementById("code").value;
  const resultElem = document.getElementById("result");

  resultElem.textContent = "採点中...";

  try {
    const res = await fetch("https://script.google.com/macros/s/AKfycbXXXXXX/exec", {
      method: "POST",
      body: JSON.stringify({ problemId, subId, code })
    });
    const data = await res.json();
    resultElem.textContent = data.result;
  } catch(e) {
    resultElem.textContent = "通信エラー: " + e.message;
  }
}

// 初期化
initProblemSelect();
</script>

</body>
</html>
